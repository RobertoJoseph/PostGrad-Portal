GO
CREATE PROC StudentData
    @studentId INT
    

AS
BEGIN
    SELECT * FROM GUCianStudent G
    INNER JOIN PostGradUser U 
    ON G.id = @studentId
    AND G.id = U.id

END

--------

GO
CREATE PROC editMyPassword
    @studentId INT,
    @oldPassword VARCHAR(10),
    @newPassword VARCHAR(10)

AS

IF(exists(select * from PostGradUser where @studentId=id and @oldPassword= password))
    BEGIN
    
        UPDATE PostGradUser
        SET  password = @newPassword
        WHERE PostGradUser.id = @studentId


    END


----------

#### TO BE ALTERED ####
^
^
^
^
GO
CREATE PROC ViewEvalProgressReport
    @studentId INT
AS
BEGIN
    IF EXISTS (
        SELECT *
        FROM GUCianProgressReport
        WHERE student_id = @studentId
    )
        BEGIN
        SELECT PR.evaluation, S.firstName, S.lastName, T.title
        FROM GUCianProgressReport PR, Supervisor S, Thesis T
        WHERE PR.student_id = @studentId AND PR.supervisor_id = S.id AND T.serialNumber = PR.thesisSerialNumber
    END
    ELSE
        BEGIN
        SELECT NPR.evaluation, S.firstName, S.lastName, T.title
        FROM NonGUCianProgressReport NPR, Supervisor S, Thesis T
        WHERE NPR.student_id = student_id AND NPR.supervisor_id = S.id AND T.serialNumber = NPR.thesisSerialNumber
    END
END


----------ADD NEW-----------

GO
CREATE PROC checkGUCian
    @ID INT,
    @Success BIT OUTPUT
AS
BEGIN
    IF EXISTS (
        SELECT *
    FROM GUCianStudent S
    WHERE S.id = @ID
    )
        BEGIN
        SET @Success = 1;
    END
    ELSE
        BEGIN
        SET @Success = 0;
    END
END
-----------







------------- Payment Procedures ---------------
----------------To Be Replaced------------------

GO
CREATE PROC ViewCoursePaymentsInstall
    @studentID INT
AS
BEGIN
    SELECT CP.course_id, I.*, C.code
    FROM NonGUCianPayCourse CP
        INNER JOIN Installment I ON I.paymentID = CP.payment_id
        INNER JOIN Course C ON C.id = CP.course_id 
    WHERE CP.NonGUCianID = @studentID
END



-----

GO
CREATE PROC ViewThesisPaymentsInstall 
    @studentID INT
AS
BEGIN
    IF EXISTS (
        SELECT *
        FROM GUCianStudent
        WHERE GUCianStudent.id = @studentID
    )
        BEGIN
        SELECT GUCianThesis.thesisSerialNumber, I.*, T.title
        FROM GUCianRegisterThesis GUCianThesis
            INNER JOIN Thesis T ON T.serialNumber = GUCianThesis.thesisSerialNumber
            INNER JOIN Installment I ON I.paymentID = T.payment_id
        WHERE GUCianThesis.GUCianID = @studentID
    END
    ELSE
        BEGIN
        SELECT NonGUCianThesis.thesisSerialNumber, I.*, T.title
        FROM NonGUCianRegisterThesis NonGUCianThesis
            INNER JOIN Thesis T ON T.serialNumber = NonGUCianThesis.thesisSerialNumber
            INNER JOIN Installment I ON I.paymentID = T.payment_id
        WHERE NonGUCianThesis.NonGUCianID = @studentID
        END
END

------------------------------------------------